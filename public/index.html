<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tailoré | Catalog & Inventory</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* --- BLACK PINK WHITE PALETTE --- */
        :root {
            --hitam: #000000;
            --putih: #ffffff;
            --pink-neon: #ff477e;
            --pink-soft: #ffeef2;
            --abu: #f4f4f4;
            --pink-dark: #cc0033;
        }

        /* RESET */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background-color: var(--abu); color: var(--hitam); line-height: 1.6; }

        /* HEADER */
        header { 
            background: var(--hitam); 
            color: var(--putih); 
            padding: 1.5rem 0; 
            border-bottom: 4px solid var(--pink-neon);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 { 
            font-weight: 800; 
            letter-spacing: 3px; 
            text-transform: uppercase; 
            font-size: 2rem; 
        }
        header span { color: var(--pink-neon); }

        .auth-section {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .user-info {
            color: var(--pink-neon);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .btn-header {
            padding: 0.5rem 1.5rem;
            background: var(--pink-neon);
            color: var(--putih);
            border: none;
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
            transition: 0.2s;
        }

        .btn-header:hover {
            background: var(--pink-dark);
            transform: translateY(-2px);
        }

        /* CONTAINER */
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 2rem; 
        }

        /* TABS */
        .tabs {
            display: flex;
            gap: 0;
            margin-bottom: 2rem;
            border: 2px solid var(--hitam);
            width: fit-content;
        }

        .tab {
            padding: 1rem 2rem;
            background: var(--putih);
            color: var(--hitam);
            border: none;
            border-right: 2px solid var(--hitam);
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
            transition: 0.2s;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab.active {
            background: var(--hitam);
            color: var(--pink-neon);
        }

        .tab:hover:not(.active) {
            background: var(--pink-soft);
        }

        /* CARD */
        .card { 
            background: var(--putih); 
            border: 2px solid var(--hitam); 
            padding: 2rem; 
            box-shadow: 8px 8px 0px var(--hitam); 
            margin-bottom: 2rem; 
        }

        .card h3 { 
            font-size: 1.5rem; 
            margin-bottom: 1.5rem; 
            color: var(--hitam); 
            border-bottom: 2px solid var(--hitam); 
            padding-bottom: 0.5rem; 
            text-transform: uppercase; 
            font-weight: 800; 
        }

        /* SEARCH & FILTERS */
        .search-section {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .form-group { margin-bottom: 1.2rem; }
        label { 
            display: block; 
            margin-bottom: 0.5rem; 
            font-weight: 600; 
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input, select { 
            width: 100%; 
            padding: 1rem; 
            border: 2px solid var(--hitam); 
            background: var(--putih); 
            font-size: 1rem; 
            font-weight: 600; 
            transition: 0.2s; 
        }

        input:focus, select:focus { 
            outline: none; 
            border-color: var(--pink-neon); 
            background: var(--pink-soft); 
        }

        /* PRODUCTS GRID */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .product-card {
            background: var(--putih);
            border: 2px solid var(--hitam);
            box-shadow: 6px 6px 0px var(--hitam);
            transition: 0.2s;
            overflow: hidden;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 8px 8px 0px var(--hitam);
        }

        .product-image {
            width: 100%;
            height: 280px;
            background: var(--abu);
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 2px solid var(--hitam);
            overflow: hidden;
            position: relative;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .stock-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--pink-neon);
            color: var(--putih);
            padding: 5px 12px;
            font-size: 0.65rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 2px solid var(--hitam);
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.4);
        }

        .out-of-stock-badge {
            background: var(--hitam);
        }

        .low-stock {
            background: #ff9500;
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-brand {
            font-size: 0.7rem;
            color: var(--pink-neon);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 0.5rem;
        }

        .product-name {
            font-size: 1rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            color: var(--hitam);
            text-transform: uppercase;
            line-height: 1.3;
            min-height: 2.6rem;
        }

        .product-meta {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .badge {
            padding: 3px 8px;
            font-size: 0.65rem;
            background: var(--hitam);
            color: var(--putih);
            font-weight: 800;
            text-transform: uppercase;
        }

        .badge.stock-low { background: var(--pink-neon); }
        .badge.stock-out { background: var(--hitam); color: var(--pink-neon); }

        .product-price {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--hitam);
            margin-bottom: 0.5rem;
        }

        .product-stock {
            font-size: 0.8rem;
            color: var(--hitam);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .stock-available { color: #00aa00; }
        .stock-low { color: var(--pink-neon); }
        .stock-out { color: var(--hitam); }

        /* BUTTONS */
        button { 
            width: 100%; 
            padding: 1rem; 
            background: var(--hitam); 
            color: var(--putih); 
            border: none; 
            font-size: 0.9rem; 
            font-weight: 800; 
            cursor: pointer; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            transition: 0.2s; 
        }

        button:hover { 
            background: var(--pink-neon); 
            transform: translateY(-2px);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--putih);
            color: var(--hitam);
            border: 2px solid var(--hitam);
        }

        .btn-secondary:hover {
            background: var(--pink-soft);
        }

        /* TABLE */
        .table-responsive { 
            overflow-x: auto; 
            border: 2px solid var(--hitam); 
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: 0.85rem; 
        }

        th { 
            background: var(--hitam); 
            color: var(--putih); 
            padding: 1rem; 
            text-align: left; 
            text-transform: uppercase; 
            font-size: 0.75rem; 
            letter-spacing: 1px; 
        }

        td { 
            padding: 1rem; 
            border-bottom: 1px solid #ddd; 
            background: var(--putih); 
            font-weight: 600; 
        }

        tr:nth-child(even) td { 
            background: var(--pink-soft); 
        }

        /* PAGINATION */
        .pagination {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin: 3rem 0;
            padding: 1.5rem;
            background: var(--putih);
            border: 3px solid var(--hitam);
            box-shadow: 6px 6px 0px var(--hitam);
        }

        .pagination button {
            width: auto;
            min-width: 50px;
            padding: 0.8rem 1.2rem;
            font-size: 0.85rem;
            font-weight: 900;
            background: var(--putih);
            border: 2px solid var(--hitam);
            box-shadow: 4px 4px 0px var(--hitam);
            transition: all 0.2s;
        }

        .pagination button:hover {
            background: var(--pink-soft);
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0px var(--hitam);
        }

        .pagination button.active {
            background: var(--pink-neon);
            color: var(--putih);
            box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.5);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--putih);
            border: 4px solid var(--hitam);
            box-shadow: 12px 12px 0px var(--hitam);
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--hitam);
            padding-bottom: 1rem;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            font-weight: 800;
            text-transform: uppercase;
            margin: 0;
            border: none;
            padding: 0;
        }

        .close-btn {
            background: var(--hitam);
            color: var(--putih);
            border: none;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            cursor: pointer;
            font-weight: 800;
            padding: 0;
        }

        .close-btn:hover {
            background: var(--pink-neon);
        }

        /* QUANTITY SELECTOR */
        .quantity-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin: 0 auto 1.5rem;
            width: fit-content;
        }

        .quantity-selector button {
            background: var(--hitam);
            color: var(--putih);
            border: none;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            font-weight: 800;
            cursor: pointer;
            transition: 0.2s;
        }

        .quantity-selector button:hover {
            background: var(--pink-neon);
            transform: scale(1.1);
        }

        .quantity-selector button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .quantity-selector input {
            width: 80px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 800;
            border: 3px solid var(--hitam);
            padding: 0.5rem;
            background: var(--putih);
        }

        .btn-checkout {
            width: 100%;
            padding: 1.5rem;
            background: var(--pink-neon);
            color: var(--putih);
            border: 3px solid var(--hitam);
            font-size: 1.2rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 6px 6px 0 var(--hitam);
        }

        .btn-checkout:hover {
            background: var(--pink-dark);
            transform: translate(-2px, -2px);
            box-shadow: 8px 8px 0 var(--hitam);
        }

        .btn-checkout:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 4rem;
            font-weight: 800;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--hitam);
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        /* ALERT */
        .alert {
            padding: 1rem;
            margin-bottom: 1rem;
            border: 2px solid var(--hitam);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9rem;
        }

        .alert-success {
            background: #e8ffe8;
            color: #00aa00;
        }

        .alert-error {
            background: var(--pink-soft);
            color: var(--pink-dark);
        }

        .alert-info {
            background: var(--pink-soft);
            color: var(--hitam);
        }

        /* STATS */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--hitam);
            color: var(--putih);
            padding: 1.5rem;
            border: 2px solid var(--hitam);
            box-shadow: 6px 6px 0px var(--hitam);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--pink-neon);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .search-section {
                grid-template-columns: 1fr;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }

            .header-container {
                flex-direction: column;
                gap: 1rem;
            }

            .tabs {
                width: 100%;
                flex-wrap: wrap;
            }

            .tab {
                flex: 1;
            }
        }

        /* HIDDEN */
        .hidden {
            display: none !important;
        }

        /* FOOTER */
        footer { 
            text-align: center; 
            padding: 2rem; 
            color: var(--hitam); 
            font-weight: 600; 
            font-size: 0.8rem; 
            opacity: 0.6; 
        }
    </style>
</head>
<body>

    <header>
        <div class="header-container">
            <h1>Tailoré<span>.</span></h1>
            <div class="auth-section">
                <div class="user-info" id="userInfo">GUEST</div>
                <button class="btn-header" id="authBtn" onclick="showLoginModal()">LOGIN</button>
            </div>
        </div>
    </header>

    <div class="container">
        
        <!-- TABS -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('catalog')" id="catalogTabBtn">CATALOG</button>
            <button class="tab" onclick="switchTab('inventory')" id="inventoryTabBtn" style="display: none;">INVENTORY</button>
        </div>

        <!-- ALERT AREA -->
        <div id="alertArea"></div>

        <!-- CATALOG TAB -->
        <div id="catalogTab" class="tab-content">
            <div class="card">
                <h3>Explore Products</h3>
                
                <div class="search-section">
                    <div class="form-group">
                        <label>SEARCH</label>
                        <input type="text" id="searchInput" placeholder="SEARCH BY NAME, BRAND, DESCRIPTION...">
                    </div>
                    
                    <div class="form-group">
                        <label>BRAND</label>
                        <select id="brandFilter">
                            <option value="">ALL BRANDS</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>CATEGORY</label>
                        <select id="categoryFilter">
                            <option value="">ALL CATEGORIES</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>COLOR</label>
                        <select id="colorFilter">
                            <option value="">ALL COLORS</option>
                        </select>
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                    <button onclick="applyFilters()" style="flex: 1;">APPLY FILTERS</button>
                    <button onclick="resetFilters()" class="btn-secondary" style="flex: 1;">RESET</button>
                </div>
            </div>

            <!-- PRODUCTS GRID -->
            <div id="productsContainer">
                <div class="loading">LOADING PRODUCTS</div>
            </div>

            <!-- PAGINATION - ALWAYS VISIBLE CONTAINER -->
            <div class="pagination" id="pagination" style="display: flex !important; min-height: 100px; background: yellow; border: 5px solid red;">
                <p style="color: black; font-weight: 900;">PAGINATION CONTAINER HERE</p>
            </div>
        </div>

        <!-- INVENTORY TAB (Admin Only) -->
        <div id="inventoryContent" class="tab-content hidden">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Products</div>
                    <div class="stat-value" id="statTotal">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Low Stock</div>
                    <div class="stat-value" id="statLowStock">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Out of Stock</div>
                    <div class="stat-value" id="statOutOfStock">0</div>
                </div>
            </div>

            <div class="card">
                <h3>Stock Management</h3>
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>PRODUCT</th>
                                <th>BRAND</th>
                                <th>SIZE</th>
                                <th>TOTAL QTY</th>
                                <th>AVAILABLE</th>
                                <th>RESERVED</th>
                                <th>ACTION</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable">
                            <tr><td colspan="7" class="loading">LOADING INVENTORY</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <!-- LOGIN MODAL -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>LOGIN</h3>
                <button class="close-btn" onclick="closeModal('loginModal')">×</button>
            </div>
            <div class="form-group">
                <label>USERNAME</label>
                <input type="text" id="loginUsername" placeholder="ENTER USERNAME">
            </div>
            <div class="form-group">
                <label>PASSWORD</label>
                <input type="password" id="loginPassword" placeholder="ENTER PASSWORD">
            </div>
            <button onclick="login()">LOGIN NOW</button>
            <p style="margin-top: 1rem; text-align: center; font-size: 0.8rem; opacity: 0.7;">
                DEFAULT: admin / admin123
            </p>
        </div>
    </div>

    <!-- PRODUCT DETAIL MODAL -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>PRODUCT DETAILS</h3>
                <button class="close-btn" onclick="closeModal('productModal')">×</button>
            </div>
            <div id="productDetailContent"></div>
        </div>
    </div>

    <!-- STOCK ADJUST MODAL -->
    <div class="modal" id="stockModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ADJUST STOCK</h3>
                <button class="close-btn" onclick="closeModal('stockModal')">×</button>
            </div>
            <div id="stockAdjustContent"></div>
        </div>
    </div>

    <footer>
        &copy; 2026 TAILORÉ CATALOG & INVENTORY SERVICE.
    </footer>

    <script>
        // CONFIG - Uses relative path to work with any host (localhost, IP, or domain)
        const API_BASE = window.location.origin + '/api';
        let currentPage = 1;
        let currentFilters = {};
        let authToken = localStorage.getItem('token') || null;
        let userData = null;

        // INIT
        document.addEventListener('DOMContentLoaded', async () => {
            if (authToken) {
                await checkAuth();
            }
            await loadFilters();
            await loadProducts();
        });

        // AUTH
        async function checkAuth() {
            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    userData = data.data;
                    updateAuthUI();
                } else {
                    logout();
                }
            } catch (error) {
                console.error('Auth check failed:', error);
            }
        }

        function updateAuthUI() {
            if (userData) {
                document.getElementById('userInfo').textContent = userData.username.toUpperCase();
                document.getElementById('authBtn').textContent = 'LOGOUT';
                document.getElementById('authBtn').onclick = logout;
                
                if (userData.role === 'admin') {
                    document.getElementById('inventoryTabBtn').style.display = 'block';
                }
            } else {
                document.getElementById('userInfo').textContent = 'GUEST';
                document.getElementById('authBtn').textContent = 'LOGIN';
                document.getElementById('authBtn').onclick = showLoginModal;
                document.getElementById('inventoryTabBtn').style.display = 'none';
            }
        }

        function showLoginModal() {
            document.getElementById('loginModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                showAlert('PLEASE FILL ALL FIELDS', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) {
                    authToken = data.data.token;
                    userData = data.data.user;
                    localStorage.setItem('token', authToken);
                    closeModal('loginModal');
                    updateAuthUI();
                    showAlert('LOGIN SUCCESSFUL!', 'success');
                    
                    // Clear inputs
                    document.getElementById('loginUsername').value = '';
                    document.getElementById('loginPassword').value = '';
                } else {
                    showAlert(data.message || 'LOGIN FAILED', 'error');
                }
            } catch (error) {
                showAlert('SERVER ERROR', 'error');
            }
        }

        function logout() {
            authToken = null;
            userData = null;
            localStorage.removeItem('token');
            updateAuthUI();
            switchTab('catalog');
            showAlert('LOGGED OUT', 'info');
        }

        // TABS
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Show/hide content
            if (tabName === 'catalog') {
                document.getElementById('catalogTab').classList.remove('hidden');
                document.getElementById('inventoryContent').classList.add('hidden');
            } else if (tabName === 'inventory') {
                if (!authToken || userData?.role !== 'admin') {
                    showAlert('ADMIN ACCESS REQUIRED', 'error');
                    return;
                }
                document.getElementById('catalogTab').classList.add('hidden');
                document.getElementById('inventoryContent').classList.remove('hidden');
                loadInventory();
                loadStats();
            }
        }

        // FILTERS
        async function loadFilters() {
            try {
                const response = await fetch(`${API_BASE}/catalog/filters`);
                const data = await response.json();

                if (data.success) {
                    // Populate filter dropdowns
                    populateSelect('brandFilter', data.data.brands);
                    populateSelect('categoryFilter', data.data.categories);
                    populateSelect('colorFilter', data.data.colors);
                }
            } catch (error) {
                console.error('Failed to load filters:', error);
            }
        }

        function populateSelect(selectId, options) {
            const select = document.getElementById(selectId);
            const firstOption = select.options[0].text;
            select.innerHTML = `<option value="">${firstOption}</option>`;
            
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option.toUpperCase();
                select.appendChild(opt);
            });
        }

        function applyFilters() {
            currentPage = 1;
            currentFilters = {
                search: document.getElementById('searchInput').value,
                brand: document.getElementById('brandFilter').value,
                category: document.getElementById('categoryFilter').value,
                color: document.getElementById('colorFilter').value
            };
            loadProducts();
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('brandFilter').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('colorFilter').value = '';
            currentFilters = {};
            currentPage = 1;
            loadProducts();
        }

        // PRODUCTS
        async function loadProducts() {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '<div class="loading">LOADING PRODUCTS</div>';

            try {
                const params = new URLSearchParams({
                    page: currentPage,
                    limit: 12,
                    inStock: true,
                    ...currentFilters
                });

                const response = await fetch(`${API_BASE}/catalog/products?${params}`);
                const data = await response.json();

                console.log('API Response:', data); // Debug

                if (data.success && data.data.length > 0) {
                    displayProducts(data.data);
                    if (data.pagination) {
                        displayPagination(data.pagination);
                    }
                } else {
                    container.innerHTML = '<div class="card"><p style="text-align: center; padding: 3rem; font-weight: 800; font-size: 1.2rem;">NO PRODUCTS FOUND</p></div>';
                    document.getElementById('pagination').style.display = 'none';
                }
            } catch (error) {
                console.error('Load products error:', error);
                container.innerHTML = '<div class="card"><p style="text-align: center; padding: 3rem; color: var(--pink-neon);">ERROR LOADING PRODUCTS</p></div>';
                document.getElementById('pagination').style.display = 'none';
            }
        }

        function displayProducts(products) {
            const container = document.getElementById('productsContainer');
            container.innerHTML = '<div class="products-grid"></div>';
            const grid = container.querySelector('.products-grid');

            products.forEach(product => {
                const stockStatus = getStockStatus(product.available_quantity);
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <div class="product-info">
                        ${stockStatus.badge}
                        <div class="product-brand">${product.brand || 'UNKNOWN'}</div>
                        <div class="product-name">${product.name}</div>
                        <div class="product-meta">
                            <span class="badge">${product.size || 'N/A'}</span>
                            <span class="badge">${product.color || 'N/A'}</span>
                        </div>
                        <div class="product-price">USD ${formatNumber(product.retail_price)}</div>
                        <div class="product-stock ${stockStatus.class}">
                            STOCK: ${product.available_quantity || 0} AVAILABLE
                        </div>
                        <button onclick="showProductDetail('${product.id}')" ${product.available_quantity === 0 ? 'disabled' : ''}>
                            ${product.available_quantity === 0 ? 'OUT OF STOCK' : 'VIEW DETAILS'}
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function getStockStatus(quantity) {
            if (quantity === 0) {
                return { badge: '<span class="stock-badge out-of-stock-badge">OUT OF STOCK</span>', class: 'stock-out' };
            } else if (quantity <= 10) {
                return { badge: '<span class="stock-badge low-stock">LOW STOCK</span>', class: 'stock-low' };
            } else {
                return { badge: '', class: 'stock-available' };
            }
        }

        function displayPagination(pagination) {
            const container = document.getElementById('pagination');
            
            console.log('=== PAGINATION DEBUG ===');
            console.log('Container:', container);
            console.log('Pagination data:', pagination);
            
            container.innerHTML = '';
            
            if (!pagination || pagination.totalPages <= 1) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'flex';
            container.style.background = 'white';
            container.style.border = '3px solid black';

            const { page, totalPages } = pagination;
            console.log(`Building pagination: page ${page} of ${totalPages}`);
            
            // Helper function to create button
            const createBtn = (text, pageNum, isActive = false) => {
                const btn = document.createElement('button');
                btn.textContent = text;
                btn.style.minWidth = '50px';
                btn.style.padding = '0.8rem 1.2rem';
                btn.style.fontSize = '0.85rem';
                btn.style.fontWeight = '900';
                btn.style.background = isActive ? '#ff477e' : 'white';
                btn.style.color = isActive ? 'white' : 'black';
                btn.style.border = '2px solid black';
                btn.style.cursor = 'pointer';
                
                if (pageNum) {
                    btn.onclick = () => { 
                        currentPage = pageNum; 
                        loadProducts();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    };
                }
                return btn;
            };

            // Previous button
            if (page > 1) {
                container.appendChild(createBtn('« PREV', page - 1));
            }

            // Page numbers (show all 10)
            for (let i = 1; i <= totalPages; i++) {
                container.appendChild(createBtn(i.toString(), i, i === page));
            }

            // Next button
            if (page < totalPages) {
                container.appendChild(createBtn('NEXT »', page + 1));
            }

            // Add page info text
            const info = document.createElement('div');
            info.style.width = '100%';
            info.style.textAlign = 'center';
            info.style.marginTop = '1rem';
            info.style.fontSize = '0.85rem';
            info.style.fontWeight = '700';
            info.style.color = 'black';
            info.textContent = `PAGE ${page} OF ${totalPages} (${pagination.total} PRODUCTS)`;
            container.appendChild(info);
            
            console.log('✅ Pagination rendered!', container.children.length, 'elements');
        }

        // PRODUCT DETAIL
        async function showProductDetail(productId) {
            try {
                const response = await fetch(`${API_BASE}/catalog/products/${productId}`);
                const data = await response.json();

                if (data.success) {
                    const product = data.data;
                    const stockStatus = getStockStatus(product.available_quantity);
                    const imageUrl = product.image_url || 'https://via.placeholder.com/400x500?text=No+Image';
                    
                    document.getElementById('productDetailContent').innerHTML = `
                        <div style="display: flex; gap: 2rem;">
                            <div style="flex: 0 0 300px;">
                                <img src="${imageUrl}" alt="${product.name}" 
                                     style="width: 100%; height: auto; border: 3px solid var(--hitam); box-shadow: 6px 6px 0 var(--hitam);"
                                     onerror="this.src='https://via.placeholder.com/400x500?text=No+Image'">
                            </div>
                            <div style="flex: 1;">
                                <div class="product-brand" style="margin-bottom: 0.5rem;">${product.brand || 'UNKNOWN'}</div>
                                <h2 style="font-size: 1.5rem; font-weight: 800; margin-bottom: 1rem; text-transform: uppercase;">${product.name}</h2>
                                
                                <div style="margin-bottom: 1.5rem;">
                                    <span class="badge">${product.category || 'N/A'}</span>
                                    <span class="badge">${product.size || 'N/A'}</span>
                                    <span class="badge">${product.color || 'N/A'}</span>
                                </div>

                                <div class="product-price" style="margin-bottom: 1rem;">USD ${formatNumber(product.retail_price)}</div>
                                
                                <div style="background: var(--pink-soft); padding: 1rem; margin-bottom: 1rem; border: 2px solid var(--hitam);">
                                    <p style="margin: 0; font-weight: 600;">
                                        <strong>RENTAL WEEKLY:</strong> USD ${formatNumber(product.price_per_week)}<br>
                                        <strong>RENTAL MONTHLY:</strong> USD ${formatNumber(product.price_per_month)}
                                    </p>
                                </div>

                                <div style="margin-bottom: 1.5rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 800;">DESCRIPTION</label>
                                    <p style="line-height: 1.6;">${product.description || 'No description available.'}</p>
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem; font-size: 0.85rem;">
                                    <div><strong>MATERIAL:</strong> ${product.material || 'N/A'}</div>
                                    <div><strong>GENDER:</strong> ${product.gender || 'N/A'}</div>
                                    <div><strong>OCCASION:</strong> ${product.occasion || 'N/A'}</div>
                                    <div><strong>SEASON:</strong> ${product.season || 'N/A'}</div>
                                </div>

                                <div class="product-stock ${stockStatus.class}" style="text-align: center; padding: 1rem; background: var(--hitam); color: var(--putih); margin-bottom: 1rem;">
                                    <strong>AVAILABLE STOCK: ${product.available_quantity || 0}</strong>
                                    ${product.reserved_quantity > 0 ? `<br><small>(${product.reserved_quantity} RESERVED)</small>` : ''}
                                </div>

                                ${product.available_quantity > 0 ? `
                                    <div style="background: var(--pink-soft); padding: 1.5rem; border: 3px solid var(--hitam); box-shadow: 6px 6px 0 var(--hitam);">
                                        <label style="display: block; text-align: center; margin-bottom: 1rem; font-weight: 800; font-size: 1.1rem;">QUANTITY</label>
                                        <div class="quantity-selector">
                                            <button onclick="decreaseQuantity()" type="button">-</button>
                                            <input type="number" id="productQuantity" value="1" min="1" max="${product.available_quantity}" readonly>
                                            <button onclick="increaseQuantity(${product.available_quantity})" type="button">+</button>
                                        </div>
                                        <button class="btn-checkout" onclick="proceedToCheckout(${product.id}, '${product.name.replace(/'/g, "\\'")}', ${product.retail_price})">
                                            ADD TO CART & CHECKOUT
                                        </button>
                                    </div>
                                ` : `
                                    <div style="background: #ffebee; padding: 1.5rem; border: 3px solid var(--hitam); text-align: center;">
                                        <strong style="color: #c62828; font-size: 1.1rem;">OUT OF STOCK</strong>
                                        <p style="margin-top: 0.5rem; font-size: 0.9rem;">This product is currently unavailable.</p>
                                    </div>
                                `}
                            </div>
                        </div>
                    `;

                    document.getElementById('productModal').classList.add('active');
                }
            } catch (error) {
                showAlert('FAILED TO LOAD PRODUCT DETAILS', 'error');
            }
        }

        // INVENTORY (Admin)
        async function loadInventory() {
            if (!authToken) return;

            const tbody = document.getElementById('inventoryTable');
            tbody.innerHTML = '<tr><td colspan="7" class="loading">LOADING INVENTORY</td></tr>';

            try {
                const response = await fetch(`${API_BASE}/inventory/stock?limit=100`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();
                console.log('Inventory response:', data);

                if (data.success) {
                    if (data.data && data.data.length > 0) {
                        tbody.innerHTML = '';
                        data.data.forEach(item => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td><strong>${item.name}</strong></td>
                                <td>${item.brand || 'N/A'}</td>
                                <td>${item.size || 'N/A'}</td>
                                <td><strong>${item.quantity}</strong></td>
                                <td style="color: ${item.available_quantity === 0 ? 'var(--pink-neon)' : '#00aa00'};">
                                    <strong>${item.available_quantity}</strong>
                                </td>
                                <td>${item.reserved_quantity}</td>
                                <td>
                                    <button onclick="showStockAdjust('${item.id}', '${item.name.replace(/'/g, "\\'")}', ${item.quantity})" 
                                            style="width: auto; padding: 0.5rem 1rem; font-size: 0.75rem;">
                                        ADJUST
                                    </button>
                                </td>
                            `;
                            tbody.appendChild(row);
                        });
                    } else {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem;">NO INVENTORY DATA FOUND</td></tr>';
                    }
                } else {
                    tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--pink-neon);">${data.message || 'FAILED TO LOAD'}</td></tr>`;
                }
            } catch (error) {
                console.error('Inventory error:', error);
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 2rem; color: var(--pink-neon);">ERROR LOADING DATA</td></tr>';
            }
        }

        async function loadStats() {
            if (!authToken) return;

            try {
                const response = await fetch(`${API_BASE}/inventory/alerts`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('statTotal').textContent = data.summary.totalProducts || 0;
                    document.getElementById('statLowStock').textContent = data.summary.lowStockCount;
                    document.getElementById('statOutOfStock').textContent = data.summary.outOfStockCount;
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        function showStockAdjust(productId, productName, currentQty) {
            document.getElementById('stockAdjustContent').innerHTML = `
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="font-weight: 800; margin-bottom: 0.5rem;">${productName}</h4>
                    <p style="font-size: 0.9rem;">CURRENT STOCK: <strong>${currentQty}</strong></p>
                </div>

                <div class="form-group">
                    <label>ADJUSTMENT QUANTITY</label>
                    <input type="number" id="adjustQty" placeholder="USE + FOR RESTOCK, - FOR REDUCE" value="0">
                    <small style="display: block; margin-top: 0.5rem; opacity: 0.7;">
                        EXAMPLE: +50 TO ADD, -10 TO REDUCE
                    </small>
                </div>

                <div class="form-group">
                    <label>REASON</label>
                    <input type="text" id="adjustReason" placeholder="RESTOCK FROM SUPPLIER, DAMAGED, ETC.">
                </div>

                <button onclick="submitStockAdjust('${productId}')">SUBMIT ADJUSTMENT</button>
            `;

            document.getElementById('stockModal').classList.add('active');
        }

        async function submitStockAdjust(productId) {
            const quantity = parseInt(document.getElementById('adjustQty').value);
            const reason = document.getElementById('adjustReason').value;

            console.log('=== STOCK ADJUST DEBUG ===');
            console.log('Product ID:', productId);
            console.log('Quantity:', quantity);
            console.log('Reason:', reason);

            if (quantity === 0 || isNaN(quantity)) {
                showAlert('QUANTITY CANNOT BE ZERO OR INVALID', 'error');
                return;
            }

            if (!reason) {
                showAlert('PLEASE PROVIDE A REASON', 'error');
                return;
            }

            try {
                const requestBody = { quantity, reason };
                console.log('Sending request:', requestBody);
                console.log('URL:', `${API_BASE}/inventory/stock/${productId}/adjust`);
                console.log('Token:', authToken ? 'Present' : 'Missing');

                const response = await fetch(`${API_BASE}/inventory/stock/${productId}/adjust`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                console.log('Response:', data);
                console.log('Response status:', response.status);

                if (response.ok) {
                    showAlert(`STOCK ADJUSTED! ${quantity > 0 ? '+' : ''}${quantity} units`, 'success');
                    closeModal('stockModal');
                    // Reload dengan delay kecil agar backend sempat update
                    setTimeout(() => {
                        loadInventory();
                        loadStats();
                    }, 500);
                } else {
                    showAlert(data.message || 'ADJUSTMENT FAILED', 'error');
                }
            } catch (error) {
                console.error('Stock adjust error:', error);
                showAlert('SERVER ERROR: ' + error.message, 'error');
            }
        }

        // HELPERS
        function formatNumber(num) {
            return new Intl.NumberFormat('id-ID').format(num);
        }

        function showAlert(message, type = 'info') {
            const alertArea = document.getElementById('alertArea');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertArea.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // QUANTITY SELECTOR FUNCTIONS
        function increaseQuantity(maxQuantity) {
            const input = document.getElementById('productQuantity');
            const currentValue = parseInt(input.value);
            if (currentValue < maxQuantity) {
                input.value = currentValue + 1;
            }
        }

        function decreaseQuantity() {
            const input = document.getElementById('productQuantity');
            const currentValue = parseInt(input.value);
            if (currentValue > 1) {
                input.value = currentValue - 1;
            }
        }

        // CHECKOUT FUNCTION
        function proceedToCheckout(productId, productName, price) {
            const quantity = parseInt(document.getElementById('productQuantity').value);
            const totalPrice = price * quantity;

            // Store cart data in localStorage
            const cartItem = {
                productId,
                productName,
                price,
                quantity,
                totalPrice,
                timestamp: new Date().toISOString()
            };

            // Get existing cart or create new one
            let cart = JSON.parse(localStorage.getItem('tailore_cart') || '[]');
            
            // Check if item already exists in cart
            const existingItemIndex = cart.findIndex(item => item.productId === productId);
            
            if (existingItemIndex > -1) {
                // Update quantity
                cart[existingItemIndex].quantity += quantity;
                cart[existingItemIndex].totalPrice = cart[existingItemIndex].price * cart[existingItemIndex].quantity;
            } else {
                // Add new item
                cart.push(cartItem);
            }

            // Save to localStorage
            localStorage.setItem('tailore_cart', JSON.stringify(cart));

            // Show success message
            showAlert(`${quantity}x ${productName} ADDED TO CART!`, 'success');

            // Close modal
            closeModal('productModal');

            // Show cart summary
            showCartSummary(cart);
        }

        // CART SUMMARY
        function showCartSummary(cart) {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cart.reduce((sum, item) => sum + item.totalPrice, 0);

            let cartHTML = '<div style="position: fixed; bottom: 2rem; right: 2rem; background: var(--hitam); color: var(--putih); padding: 1.5rem; border: 3px solid var(--pink-neon); box-shadow: 8px 8px 0 var(--pink-neon); min-width: 300px; z-index: 9999;">';
            cartHTML += '<h4 style="margin-bottom: 1rem; font-size: 1.2rem;">🛒 SHOPPING CART</h4>';
            
            cart.forEach(item => {
                cartHTML += `<div style="margin-bottom: 0.5rem; font-size: 0.9rem;">
                    ${item.quantity}x ${item.productName}<br>
                    <strong>USD ${formatNumber(item.totalPrice)}</strong>
                </div>`;
            });

            cartHTML += `<hr style="border: 1px solid var(--pink-neon); margin: 1rem 0;">`;
            cartHTML += `<div style="font-weight: 800; font-size: 1.1rem; margin-bottom: 1rem;">TOTAL: USD ${formatNumber(totalPrice)}</div>`;
            cartHTML += `<button onclick="finalizeCheckout()" style="width: 100%; padding: 1rem; background: var(--pink-neon); color: var(--putih); border: none; font-weight: 800; cursor: pointer; margin-bottom: 0.5rem;">PROCEED TO PAYMENT</button>`;
            cartHTML += `<button onclick="closeCartSummary()" style="width: 100%; padding: 0.5rem; background: transparent; color: var(--putih); border: 1px solid var(--putih); font-weight: 600; cursor: pointer;">CONTINUE SHOPPING</button>`;
            cartHTML += '</div>';

            // Remove existing cart summary if any
            const existingSummary = document.getElementById('cartSummaryFloat');
            if (existingSummary) existingSummary.remove();

            // Add new cart summary
            const cartDiv = document.createElement('div');
            cartDiv.id = 'cartSummaryFloat';
            cartDiv.innerHTML = cartHTML;
            document.body.appendChild(cartDiv);
        }

        function closeCartSummary() {
            const cartSummary = document.getElementById('cartSummaryFloat');
            if (cartSummary) cartSummary.remove();
        }

        function finalizeCheckout() {
            const cart = JSON.parse(localStorage.getItem('tailore_cart') || '[]');
            
            if (cart.length === 0) {
                showAlert('CART IS EMPTY', 'error');
                return;
            }

            const totalPrice = cart.reduce((sum, item) => sum + item.totalPrice, 0);
            
            // Here you would integrate with payment gateway
            // For now, we'll show a confirmation
            const confirmed = confirm(`Total Payment: USD ${formatNumber(totalPrice)}\n\nProceed to payment?`);
            
            if (confirmed) {
                // Clear cart
                localStorage.removeItem('tailore_cart');
                closeCartSummary();
                showAlert('ORDER PLACED SUCCESSFULLY! 🎉', 'success');
                
                // In real implementation, redirect to payment page or process payment
                console.log('Order details:', cart);
            }
        }

        // Search on Enter
        document.getElementById('searchInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') applyFilters();
        });
    </script>

</body>
</html>
